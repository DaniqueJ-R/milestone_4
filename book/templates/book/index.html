{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}
Home
{% endblock %}

{% block header %}
    <header class="bg-image">
<!-- Header with user info -->
       <div class="container">
        <div class="my-auto pt-4 text-center row justify-content-end">
      <div class="col-7">
        <h1>Welcome to Little Library</h1>
        <p>Your hub for the world of books</p>
        <!-- User name greeting -->
        {% if request.user.is_authenticated %}
        <p class="index-greeting">Welcome back <a href="" class="no-decor main-color accent">{{ user.username }}</a>, Let's catch up on your progress!</p>
        {% else %}
        <p class="index-greeting">Welcome! You can <a href="{% url 'account_login' %}" class="no-decor main-color accent">log in</a> or <a href="{% url 'account_signup' %}" class="no-decor main-color accent">register</a> so you can log your progress.</p>
        {% endif %}
      </div>
      </div>
      </div>
      </header>
{% endblock %}

{% block content %}
<main class="container text-center my-2">
  <!-- Books to read this week carasol -->
  {% if request.user.is_authenticated %}
  <section class="books-row row-cols-auto py-3 text-center" id="bookshelves">
    <h2>Bookselves</h2>
    <a href="{% url 'my_library'%}#reading-header " class="shelves-link-text p-3">
      <span class="accent">{{ reading_count }}</span> Reading
    </a>
    <a href="{% url 'my_library' %}#complete-header" class="shelves-link-text p-3">
      <span class="accent">{{ completed_count }}</span> Complete
    </a>
    <a href="{% url 'my_library' %}#plan-to-read-header" class="shelves-link-text p-3">
      <span class="accent">{{ plan_count }}</span> Plan to read
    </a>
  </section>
  <!-- Current books user is reading -->
  <section class="books-row row-cols-auto" id="current-books">
    <a href="" class="no-decor main-color">
      <h2>In Progress</h2>
    </a>

    {% for book in reading_books %}
    <a type="button" href="{% url 'book_details' book.book.slug %}" class="display-books unauth-books col" data-bs-container="body" data-bs-toggle="popover"
      data-bs-placement="top" data-bs-content="{{ book.book.title }}" data-bs-trigger="hover focus">
      <img src="{{ book.book.cover_image_url }}" alt="{{ book.book.title }}">
    </a>
    {% endfor %}
    
  </section>
  <!-- Books to read this week carasol -->
  <section class="books-row row-cols-auto pt-5" id="books-to-read">
    <a href="" class="no-decor main-color">
      <h2>Books this week</h2>
    </a>
    {% for book in featured_books_auth %}
    <a type="button" href="{% url 'book_details' book.slug %}" class="display-books unauth-books col" data-bs-container="body" data-bs-toggle="popover"
      data-bs-placement="top" data-bs-content="{{ book.title }}" data-bs-trigger="hover focus">
      <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
    </a>
    {% endfor %}
  </section>
  <section class="row justify-content-center pt-5 pb-4" id="reviews-area">
    <div class=" text-center">
      <p>See your more recent reviews here:</p>
    </div>
  {% if recent_reviews %}
  {% for review in recent_reviews %}
    <div class="card mb-3 col-12 col-lg-6 reviews" style="max-width: 540px;">
      <div class="row g-0">
        <div class="col-md-4">
          <a type="button" href="{% url 'book_details' review.book.slug %}" data-bs-container="body" data-bs-toggle="popover"
      data-bs-placement="top" data-bs-content="{{ review.book.title }}" data-bs-trigger="hover focus">
          <img src="{{ review.book.cover_image_url }}" class="img-fluid rounded-start review-image" alt="{{ review.book.title }}">
          </a>
        </div>
        <div class="col-md-8 align-self-center">
          <div class="card-body pt-0">
            <h5 class="card-title pt-4">{{ review.review_title }}</h5>
            <!-- In your review card -->
<p class="card-text review-body short-review" id="review-{{ review.id }}">
  {{ review.review_body|truncatewords:45 }}
  {% if review.review_body|wordcount > 45 %}
    <a href="#" class="show-more-link" data-review-id="{{ review.id }}">Show more</a>
  {% endif %}
</p>

<p class="card-text review-body full-review" id="full-review-{{ review.id }}" style="display:none;">
  {{ review.review_body }}
  <a href="#" class="show-less-link" data-review-id="{{ review.id }}">Show less</a>
</p>

            <p class="card-text"><small class="text-body-secondary">{{ review.star_rating }}/5 <i class="fa-solid fa-star"></i> <br>
            Reviewed {{ review.updated_on|naturaltime }}</small></p>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
{% else %}
  <p class="text-center text-muted">No recent reviews yet.<a href="{% url 'my_library' %}#complete-header"> Leave one now!</a></p>
{% endif %}

  </section>
  {% else %}
    <!-- Books to read this week carasol -->
  <section class="books-row row-cols-auto pt-5" id="books-to-read">
    <a href="" class="no-decor main-color">
      <h2>Books this week</h2>
    </a>
    {% for book in featured_books_unauth %}
    <a type="button" href="{% url 'book_details' book.slug %}" class="display-books unauth-books col" data-bs-container="body" data-bs-toggle="popover"
      data-bs-placement="top" data-bs-content="{{ book.title }}" data-bs-trigger="hover focus">
      <img class="featured-books" src="{{ book.cover_image_url }}" alt="{{ book.title }}">
    </a>
    {% endfor %}
  </section>
  <!-- Why sign up -->
  <section class="row pt-5 justify-content-center">
    <div class="card text-center col-12 col-sm-2 join-us">
      <div class="card-body join-gold">
        <h5 class="card-title">Special title treatment</h5>
        <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
      </div>
    </div>
    <div class="card text-center col-12 col-sm-2 join-us">
      <div class="card-body join-green">
        <h5 class="card-title">Special title treatment</h5>
        <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
      </div>
    </div>
    <div class="card text-center col-12 col-sm-2 join-us">
      <div class="card-body join-gold">
        <h5 class="card-title">Special title treatment</h5>
        <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
      </div>
    </div>
    <div class="card text-center col-12 col-sm-2 join-us">
      <div class="card-body join-green">
        <h5 class="card-title">Special title treatment</h5>
        <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
      </div>
    </div>
    <div class="card text-center col-12 col-sm-2 join-us">
      <div class="card-body join-gold">
        <h5 class="card-title">Special title treatment</h5>
        <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
      </div>
    </div>
    <div class="card text-center col-12 col-sm-2 join-us">
      <div class="card-body join-green">
        <h5 class="card-title">Special title treatment</h5>
        <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
      </div>
    </div>
  </section>
  <section class="row justify-content-center" id="reviews-area">
    <div class=" text-center py-4">
      <p id="promo">Write and share reviews. Compile your own lists. Share your life through the pages.</p>
      <p>Below are some popular reviews and lists from this week.  <a href="{% url 'account_signup' %}" class="no-decor main-color accent">Sign up</a> to leave your own signature.</p>
    </div>
      {% for review in recent_reviews %}
    <div class="card mb-3 col-12 col-lg-6 reviews" style="max-width: 540px;">
      <div class="row g-0">
        <div class="col-md-4">
          <a type="button" href="{% url 'book_details' review.book.slug %}" data-bs-container="body" data-bs-toggle="popover"
      data-bs-placement="top" data-bs-content="{{ review.book.title }}" data-bs-trigger="hover focus">
          <img src="{{ review.book.cover_image_url }}" class="img-fluid rounded-start" alt="{{ review.book.title }}">
          </a>
        </div>
        <div class="col-md-8 align-self-center">
          <div class="card-body pt-0">
            <h5 class="card-title">{{ review.review_title }}</h5>
            <!-- In your review card -->
<p class="card-text review-body short-review" id="review-{{ review.id }}">
  {{ review.review_body|truncatewords:45 }}
  {% if review.review_body|wordcount > 45 %}
    <a href="#" class="show-more-link" data-review-id="{{ review.id }}">Show more</a>
  {% endif %}
</p>

<p class="card-text review-body full-review" id="full-review-{{ review.id }}" style="display:none;">
  {{ review.review_body }}
  <a href="#" class="show-less-link" data-review-id="{{ review.id }}">Show less</a>
</p>

            <p class="card-text mt-0 py=t-0"><small class="text-body-secondary">{{ review.star_rating }}/5 <i class="fa-solid fa-star"></i> <br>
            Reviewed {{ review.updated_on|naturaltime }}</small></p>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
  </section>
  {% endif %}
</main>
{% endblock %}